10 def_start()11 dim block[253],fname$[50],path$[50]15 local btype17 device 0:repeat:until get(0)==0:device -120 repeat22  btype=_waitForSOHorETB()25  if btype==130   if _getBlock()==035    _processBlock0()40   else45    _processBlockn()50   endif55  endif60 until btype<>165 _finish()70 enddef100 def_waitForSOHorETB()110 print "SOH/ETB "120 device 0130 repeat:k=get(1):until (k==1)|(k==23)140 put 6150 device -1155 return k160 enddef200 def_getBlock()210 print "Reading block "220 device 0225 cs=0230 for i=1,253,1240 k=get(1)250 cs=cs+k255 block[i]=k270 next275 if (cs&255):put 21:else:put 6:endif280 device -1281 print block[1],chr(13),chr(11)285 return block[1]290 enddef300 def_processBlock0()310 i=2:fname$=""315 repeat:i=i+1:fname$=fname$+chr(block[i]):until block[i]==0335  repeat:path$=""340   repeat:i=i+1:path$=path$+chr(block[i]):until block[i]==0345  chdir path$350  until block[i+1]==0365 f=fcreate(fname$)370 enddef500 def_finish()505 fclose510 println520 enddef600 def_processBlockn()601 device 2605 for i=3,block[2]+2,1620  put block[i]630 next640 device -1650 enddef