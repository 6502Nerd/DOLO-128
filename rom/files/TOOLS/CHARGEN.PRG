1000 def_init()1001 local x,y1002 dim f$[20]1005 mode 1:cursor 1:printat 17,101010  fontBase=0x0000:spriteBase=0x08001015  for x=0,31,1:for y=0,7,1:plot x,y+16,x+y*32:next:next1020  vpoke spriteBase,255:vpoke spriteBase+7,2551025  for y=1,6,1:vpoke spriteBase+y,129:next1026  for y=8,14,1:vpoke fontBase+y,254:next:vpoke fontBase+15,01027  for y=0,6,1:vpoke fontBase+y,1:next:vpoke fontBase+7,2551030  sizeX=1:sizeY=11089  blank=0:solid=1:space=321090  plot 22,0,"E - Edit":plot 22,1,"X - Size X"1100  plot 22,2,"Y - Size Y":plot 22,3,"C - Char"1110  plot 22,4,"M - Mirror":plot 22,5,"F - Flip"1120  plot 22,6,"I - Invert":plot 22,7,"P - Paint"1900 enddef1999 ;2000 def_start()2005  _init()2006  curX=0:curY=0:_cursor(curX,curY)2010  s=0:curCh=128:_render(curCh)2020  repeat2030   k=key(1)2040   if k=='c':s=1:elif k=='s':s=2:elif (k=='e')|(k==13):s=02050   elif k=='l':s=3:elif k=='q':s=42051   elif k=='x':s=5:elif k=='y':s=52052   elif k=='m':s=6:elif k=='f':s=7:elif k=='i':s=82053   elif k=='p':s=9:elif k=='z':s=102054   elif (k=='<')|(k=='>'):s=112059   endif2060   if s==0:_edit():endif2070   if s==1:_char():endif2080   if s==2:_save():endif2090   if s==3:_load():endif2100   if s==4:_quit():endif2101   if s==5:_size():endif2102   if s==6:_mirror():endif2103   if s==7:_flip():endif2104   if s==8:_invert():endif2105   if s==9:_palette():endif2106   if s==10:_zero():endif2107   if s==11:_nextChar():endif2119  until s==42120 enddef2199 ;2200 def_cursor(xpos,ypos)2205  sprite 0,xpos*8,ypos*8-1,0,0x012210 enddef2299 ;2300 def_edit()2305  if (k=='e')|(k==13):curX=0:curY=0:_render(curCh):endif2310  if (k==' ')|(k=='1')|(k=='0')2311    m=k-48:if m<0:m=2:endif2312    _setBit(curX,curY,curCh,m)2313    curX=curX+1:if curX>=(sizeX*8-1):curX=0:curY=curY+1:if curY>=(sizeY*8-1):curY=0:endif:endif2314  endif2315  if k==8:curX=curX-1:if curX<0:curX=sizeX*8-1:endif:endif2316  if k==9:curX=curX+1:if curX>=(sizeX*8-1):curX=0:endif:endif2317  if k==10:curY=curY+1:if curY>=(sizeY*8-1):curY=0:endif:endif2318  if k==11:curY=curY-1:if curY<0:curY=sizeY*8-1:endif:endif2388  _cursor(curX,curY)2389 enddef2399 ;2400 def_render(ch)2410 local x,y,byte,bit2415  _cursor(curX,curY)2420  for x=0,1,12430   for y=0,15,12440    if (x>=(sizeX-1))|(y>=(sizeY*8-1))2446     plot x*8,y,"        "2447    else2448     byte=vpeek(fontBase+x*(sizeY*8)+y+ch*8)2450     for bit=0,7,12500      if (byte&128)2510       plot x*8+bit,y,solid2520      else2530       plot x*8+bit,y,blank2535      endif2536      byte=byte<<12540     next2545    endif2550   next2560  next2561  for x=0,sizeX,1:for y=0,sizeY,12562   plot 18+x,1+y,ch+x*sizeY+y2563   if (x>=(sizeX-1))|(y>=(sizeY-1))2564    plot 18+x,1+y,space2565   else2566    plot 18+x,1+y,ch+x*sizeY+y2567   endif2568  next:next2570 enddef2599 ;2600 def_setBit(x,y,ch,m)2610 local addr,byte,mask2620  addr=fontBase+ch*8+(x/8)*(8*sizeY)+y2621  byte=vpeek(addr)2622  mask=1 << (7-(x&7))2630  if (byte&mask)2640   if(m==0)|(m==2):byte=byte-mask:plot x,y,blank:endif2647  else2650   if(m==1)|(m==2):byte=byte+mask:plot x,y,solid:endif2660  endif2665  vpoke addr,byte2670 enddef2699 ;2700 def_char()2705  repeat2710  if k=='c':curX=0:curY=4:endif2720  if k==8:curX=curX-1:if curX<0:curX=31:endif:endif2730  if k==9:curX=curX+1:if curX>31:curX=0:endif:endif2740  if k==10:curY=curY+1:if curY>7:curY=0:endif:endif2750  if k==11:curY=curY-1:if curY<0:curY=7:endif:endif2760  curCh=curX+32*curY2770  _cursor(curX,curY+16)2772  k=key(1)2775  until k==132776 _render(curCh)2780 enddef2799 ;2800 def_size()2810  if k=='x':sizeX=sizeX\2+1:elif k=='y':sizeY=sizeY\2+1:endif2820  curX=0:curY=0:_render(curCh)2825  s=02830 endif2840 enddef2900 ;2910 def_getfname()2920  printat 17,14,"File:":input f$2930 enddef2940 ;2950 def_clearfname()2960  printat 17,14,"                "2970  s=02980 enddef2990 ;3000 def_save()3010  _getfname()3020  bsave 'v',0,0,2048,f$3030  _clearfname()3050 enddef3060 ;3070 def_load()3080  _getfname()3090  bload 'v',0,0,f$3100  _clearfname()3105  _render(curCh)3110 enddef3120 ;3130 def_zero()3140 local adr3150  for adr=fontBase+curCh*8,fontBase+curCh*8+8*sizeX*sizeY-1,13160    vpoke adr,03170  next3180  _render(curCh)3190 enddef3200 ;3210 def_nextChar()3220   if k=='<':curCh=curCh-(sizeX*sizeY):if curCh<0:curCh=256-(sizeX*sizeY):endif:endif3230   if k=='>':curCh=curCh+(sizeX*sizeY):if curCh>255:curCh=0:endif:endif3240   _render(curCh)3250 enddef